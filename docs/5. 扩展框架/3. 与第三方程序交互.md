# 与第三方程序交互

### 一. Yar

	require '../../crossboot.php';
	
	$conf = array(
	    'server'    =>  array(
	        'id'    =>  2,
	        'name'  =>  'test',
	        'ver'   =>  '1.1',
	    ),
	);	
	
	$service = new Yar_Server( Cross::loadApp( 'api', $conf ) );
	$service->handle();
	

### 二. ZMQ

	require '../../crossboot.php';
	
	$conf = array(
	    'server'    =>  array(
	        'id'    =>  2,
	        'name'  =>  'test',
	        'ver'   =>  '1.1',
	    ),
	);
	
	$context = new ZMQContext(1);
	
	//  Socket to talk to clients
	$responder = new ZMQSocket($context, ZMQ::SOCKET_REP);
	$responder->bind("tcp://127.0.0.1:5678");
	
	while (true) {
	    //  Wait for next request from client
	    $request = $responder->recv();
	
	    $request_array = array();
	    parse_str( $request, $request_array );
	
	    $controller = isset($request_array['mode']) ? $request_array['mode'] : '';
	    if( $controller )
	    {
	        if(false !== strpos($controller, '.')) {
	            $controller = str_replace('.', ':', $controller);
	        } else {
	            $controller = "{$controller}:index";
	        }
	        unset($request_array['mode']);
	    } else {
	        $controller = 'main:index';
	    }
	
	    ob_start();	
	    try {
	
	        Cross::loadApp( 'api', $conf )->get( $controller, $request_array );
	
	    } catch(Exception $e) {	
	        $e->getMessage();	
	    }
	
	    $req = ob_get_clean();
	    $responder->send( $req );
	}