# MySQL查询

假设 `modules\web\UserModule.php` 中的代码如下：

	namespace modules\web;
		
	use Cross\MVC\Module;

	class UserModule extends Module
	{
		protected $t_user = 'front_user';

		function getUser() 
		{

		}
	}

连接数据库后, 在module的方法中就可以使用 `$this->link` 属性使用连接类提供的方法查询了,以MySql类默认提供的查询为例.


## 一 查询

1. 查询单条记录

		function getUser() 
		{
			return $this->link->get($this->t_user, '*', 'score=1')
		}
	
	也可以用数组表示
	
		function getUser() 
		{
			return $this->link->get($this->t_user, '*', array(
				'score' => 1
			));
		}

2. 查询多条记录

		function getUser() 
		{
			return $this->link->getAll($this->t_user, '*');
		}

3. 使用条件查询

		function getUser() 
		{
			return $this->link->getAll($this->t_user, '*', array(
				'score' => array('>', 1)
			));
		｝

	查询score 大于 1的用户 类似的操作还可以使用`>`, `<>`等。

		function getUser() 
		{
			return $this->link->getAll($this->t_user, '*', array(
				'name' => array('like', 'john')
			));
		｝
	使用like查询

4. 使用IN、OR查询
	
		function getUser()
		{
			return $this->link->getAll($this->t_user, '*', array(
				'id' => array('in', array(1,2,3))
			));
		}

	对应的sql语句为 `SELECT * FROM back_acl_menu WHERE id IN (?,?,?)`

		function getUser()
		{
			return $this->link->getAll($this->t_user, '*', array(
					'id' => array('or', array(1, 2, 3))
				));
		}
	对应的sql语句为： `SELECT * FROM front_user WHERE id = ? OR id = ? OR id = ?`

5. 为OR中的某一项指定条件

		function getUser()
		{
			return $this->link->getAll($this->t_user, '*', array(
					'id' => array('or', array(1, 2, 3, array('>', 5) ))
				));
		}
	此时生成的sql语句为 `SELECT * FROM front_user WHERE id = ? OR id = ? OR id = ? OR id > ?`


6. 使用BETWEEN

		function getUser()
		{
			return $this->link->getAll($this->t_user, '*', array(
				'id'    =>  array('between', array(1, 2))
			));
		}
	生成的SQL语句模板为 `SELECT * FROM front_user WHERE id BETWEEN 1 AND 2`

7. 带分页数据的查询

		function getUser(& $page = array('p'=>1, 'limit'=>30))
		{
			$this->link->find($this->t_user, '*', array(
				'score'	=> array('>', 1),
			), 'id DESC', $page);
		｝

8. 混合使用

		function getUser()
		{
			return $this->link->getAll($this->t_user, '*', array(
	            'id'    =>  array('in', array(7, 2, 3)),
	            'pid'   =>  array('or', array(1, 2 => array('>', 2)))
			));
		}
	生成的sql语句为 `SELECT * FROM front_user WHERE id IN (?,?,?) AND pid = ? OR pid > ?`

9. 左右连接

		function getUser()
		{
			return $this->link->getAll("{$this->t_user} tu LEFT JOIN front_user_base fub ON tu.id=fub.id", '*', array(
	            'id'    =>  1
			));
		}

## 二. 添加记录

添加单条记录
		
		function getUser()
		{
			$this->link->add($this->t_user, array(
				'score'	=> 5,
				'group'	=>	1,
			));
		｝

>如果主键是id返回id, 否则总是返回 `true`

批量添加 
		function getUser()
		{		
			$insert_data = array();
		
			$this->link->add($this->t_user, array(
				'fields' = array('score', 'group'),
				'values' = array(
					array(5, 1),	
					array(5, 2),
					array(5, 3),
				)
			), true, $insert_data);
		｝

>`insert_data` 返回的值为添加以后结果.

## 三. 删除记录

删除单条记录

		function getUser()
		{
			$this->link->del($this->t_user, array(
				'id'=>1
			));
		｝

批量删除id等于1和id等于2的用户

		function getUser()
		{
			$this->link->del($this->t_user, array(
		        'fields' => array('id'),
		        'values' => array(
		            array(1),
		            array(2),
		        ),
			), true);
		｝

### 四. 直接执行sql语句
返回单条记录

	function getUser($sql)
	{
    	$this->link->fetchOne($sql, $model = PDO::FETCH_ASSOC);
	｝

返回多条记录

	function getUser($sql)
	{
		$this->link->fetchAll($sql, $model = PDO::FETCH_ASSOC);
	｝

> 适用于不带参数的sql查询

### 五. 手动绑定参数

>$sql =  "select fri.*, fue.* from ( select * from front_user where uid = ?) fri  
>left join front_user_extend fue on fri.id=fue.uid"

	$this->link->prepare($sql)->exec(array(1))->stmt_fetch(true);